{# templates/benevoles/liste.html.twig #}
{% extends 'baseedit.html.twig' %}


{% block body %}
     <style>
     
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border: 2px solid #141010;
            line-height: 1.5;
        }

        th {
            background-color: #a0eecc;
            font-weight: bold;
        }

        td a {
            color: #007bff;
            text-decoration: none;
        }

        td a:hover {
            text-decoration: underline;
        }

        th:nth-child(1), td:nth-child(1) {
            width: 1%;
        }

        th:nth-child(2), td:nth-child(2) {
            width: 1%;
        }

        th:nth-child(3), td:nth-child(3) {
            width: 1%;
        }

        th:nth-child(4), td:nth-child(4) {
            width: 1%;
        }
        th:nth-child(5), td:nth-child(5) {
            width: 10%;
        }
        th:nth-child(6), td:nth-child(6) {
            width: 10%;
        }
         th:nth-child(7), td:nth-child(7) {
            width: 2%;
        }
         th:nth-child(8), td:nth-child(8) {
            width: 1%;
        } 
        th:nth-child(9), td:nth-child(9) {
            width: 10%;
        }
         th:nth-child(10), td:nth-child(10) {
            width: 5%;
        }
         th:nth-child(11), td:nth-child(11) {
            width: 5%;
        }
         th:nth-child(12), td:nth-child(12) {
            width: 1%;
        }
        th:nth-child(13), td:nth-child(13) {
            width: 15%;
        }
        th:nth-child(14), td:nth-child(14) {
            width: 1%;
        }
        th:nth-child(15), td:nth-child(15) {
            min-width: 1%;
        }
         th:nth-child(16), td:nth-child(16) {
            min-width: 5%;
        }
         th:nth-child(17), td:nth-child(17) {
            width: 5%;
        }
        .numero-ligne {
        background-color: #a0eecc; 
        font-weight: bold;
        }
        @media print {
        /* Cacher les éléments inutiles à l'impression */
        button, .no-print, nav, .actions {
            display: none !important;
        }
    
        /* Optionnel : adapter la mise en page imprimée */
        body {
            font-size: 8pt;
            color: #000;
        }
    
        table {
            width: 100%;
            border-collapse: collapse;
        }
    
        table, th, td {
            border: 1px solid #333;
            padding: 5px;
        }
         tr {
        page-break-inside: avoid;
    }
        }
   /* Bouton retour en haut */
        #backToTop {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background-color: #a0eecc;
            color: #000;
            border: none;
            border-radius: 50%;
            padding: 12px 16px;
            font-size: 20px;
            cursor: pointer;
            display: none; /* caché par défaut */
            box-shadow: 0px 4px 6px rgba(0,0,0,0.2);
            z-index: 999;
        }

        #backToTop:hover {
            background-color: #7ddfc3;
        }
    </style>

    <form method="get" action="{{ path('app_benevoles_liste') }}" class="no-print">
        {% set existingFields = (app.request.query.all('field') ?? []) %}
        {% set existingSearches = (app.request.query.all('search') ?? []) %}

        <div id="criteria-container">
            {% if existingFields is iterable and existingFields|length > 0 %}
                {% for i in 0..(existingFields|length - 1) %}
                    {% set f = existingFields[i] %}
                    {% set s = existingSearches[i] is defined ? existingSearches[i] : '' %}
                    <div class="criteria-row" style="margin-bottom:8px;">
                        <select name="field[]">
                            <option value="secteur" {{ f == 'secteur' ? 'selected' : '' }}>Secteur</option>
                            <option value="sexe" {{ f == 'sexe' ? 'selected' : '' }}>Genre</option>
                            <option value="nom" {{ f == 'nom' ? 'selected' : '' }}>Nom</option>
                            <option value="prenom" {{ f == 'prenom' ? 'selected' : '' }}>Prénom</option>
                            <option value="enfant_suivie" {{ f == 'enfant_suivie' ? 'selected' : '' }}>Enfant(s) suivi(s)</option>
                            <option value="telephone" {{ f == 'telephone' ? 'selected' : '' }}>Téléphone</option>
                            <option value="adresse" {{ f == 'adresse' ? 'selected' : '' }}>Adresse</option>
                            <option value="code_postal" {{ f == 'code_postal' ? 'selected' : '' }}>Code Postal</option>
                            <option value="ville" {{ f == 'ville' ? 'selected' : '' }}>Ville</option>
                            <option value="email" {{ f == 'email' ? 'selected' : '' }}>Email</option>
                            <option value="age" {{ f == 'age' ? 'selected' : '' }}>Âge</option>
                        </select>
                        <input type="text" name="search[]" placeholder="Valeur..." value="{{ s }}" />
                        <button type="button" class="remove-criteria" onclick="this.parentElement.remove()">✖</button>
                    </div>
                {% endfor %}
            {% else %}
                <div class="criteria-row" style="margin-bottom:8px;">
                    <select name="field[]">
                        <option value="secteur">Secteur</option>
                        <option value="sexe">Genre</option>
                        <option value="nom">Nom</option>
                        <option value="prenom">Prénom</option>
                        <option value="enfant_suivie">Enfant(s) suivi(s)</option>
                        <option value="telephone">Téléphone</option>
                        <option value="adresse">Adresse</option>
                        <option value="code_postal">Code Postal</option>
                        <option value="ville">Ville</option>
                        <option value="email">Email</option>
                        <option value="age">Âge</option>
                    </select>
                    <input type="text" name="search[]" placeholder="recherche" />
                    <button type="button" class="remove-criteria" onclick="this.parentElement.remove()">✖</button>
                </div>
            {% endif %}
        </div>

        <button type="button" id="add-criteria" style="margin-bottom:8px;">+ Ajouter un critère</button>

        <script>
        function ouvrirEmail() {
            const emails = "{{ emails|join(',') }}";
            const emailsEncoded = encodeURIComponent(emails);
            const gmailUrl = `https://mail.google.com/mail/?view=cm&fs=1&bcc=${emailsEncoded}`;
            window.open(gmailUrl, '_blank');
        }

        document.getElementById('add-criteria').addEventListener('click', function() {
            const container = document.getElementById('criteria-container');
            const div = document.createElement('div');
            div.className = 'criteria-row';
            div.style.marginBottom = '8px';
            div.innerHTML = `
                <select name="field[]">
                    <option value="secteur">Secteur</option>
                    <option value="sexe">Genre</option>
                    <option value="nom">Nom</option>
                    <option value="prenom">Prénom</option>
                    <option value="enfant_suivie">Enfant(s) suivi(s)</option>
                    <option value="telephone">Téléphone</option>
                    <option value="adresse">Adresse</option>
                    <option value="code_postal">Code Postal</option>
                    <option value="ville">Ville</option>
                    <option value="email">Email</option>
                    <option value="age">Âge</option>
                </select>
                <input type="text" name="search[]" placeholder="Valeur..." />
                <button type="button" class="remove-criteria" onclick="this.parentElement.remove()">✖</button>
            `;
            container.appendChild(div);
        });
        </script>

        <select name="year" onchange="this.form.submit()">
            <option value="all" {{ year == 'all' ? 'selected' : '' }}>Année courante</option>
            {% for availableYear in availableYears %}
                {% if availableYear != 'all' %}
                    <option value="{{ availableYear }}" {{ year == availableYear ? 'selected' : '' }}>
                        {{ availableYear }}
                    </option>
                {% endif %}
            {% endfor %}
        </select>
         <div class="btn-group" role="group" aria-label="Choix de la liste" style="position: relative; left: 40px; margin-top: -10px;">
    <button type="submit" style="
        font-size: 18px;       /* texte plus grand */
        padding: 12px 30px;   /* plus de padding haut/bas et gauche/droite */
        background-color: #a0eecc; /
        color: white;          /* texte blanc */
        border: none;          /* sans bordure */
        border-radius: 4px;    /* coins arrondis */
        cursor: pointer;       /* pointeur au survol */
        min-width: 140px;      /* largeur mini */
    ">
        Rechercher
    </button>
    </div>
    </form>
<div class="btn-group" role="group" aria-label="Choix de la liste" style="position: relative; left: 400px; margin-top: 20px;">
        <a href="{{ path('app_benevoles_liste') }}" 
           class="btn btn-primary {% if app.request.get('_route') == 'app_benevoles_liste' %}active{% endif %}" 
           style="padding: 12px 30px; font-size: 1rem; min-width: 150px;">
            Liste Bénévoles
        </a>
        <a href="{{ path('app_enfant_liste') }}" 
           class="btn btn-primary {% if app.request.get('_route') == 'app_enfant_liste' %}active{% endif %}" 
           style="padding: 12px 30px; font-size: 1rem; min-width: 150px;">
            Liste Enfants
        </a>
        
           <div class="btn-group" role="group" aria-label="Choix de la liste" style="position: relative; left: 300px; margin-top: 10px;">
        <button type="button" class="btn btn-primary" onclick="ouvrirEmail()">
            📧 Envoyer un email groupé
        </button>
        <button onclick="window.print()" class="btn btn-primary">
        🖨️ Imprimer la liste
        </button>
        </div>
        </div>

    <table>
        <thead>
        <tr>
            <th>n°</th>
            <th class="no-print">Options</th>
            <th>Secteur</th>
            <th>Genre</th>
            <th>Nom</th>
            <th>Prénom</th>
            <th>Âge</th>
            <th>Enfant(s) suivi(s)</th>
            {#<th>Téléphone</th>#}
            <th>Adresse</th>
            {#<th>Code postal</th>#}
            {#<th>Ville</th>#}
            <th>Email</th>
            <th>Casier Judiciaire</th>
            <th>Déplacement</th>
            <th>Matière Accompagement</th>
            <th>Niveau Accompagement</th>
            {#<th>Information complémentaire</th>#}
            <th>comment nous connaitre</th>
            <th>don</th>


        </tr>
        </thead>
        <tbody>
        {% for benevole in benevoles %}
            <tr>
                <td class="numero-ligne">{{ loop.index }}</td>
                <td class="no-print">
                    <a href="{{ path('app_benevoles_detail', { 'id': benevole.id }) }}" 
                   class="btn btn-info btn-rounded"
                   style="background-color: #d59bf6; color: white; border: none; padding: 8px 20px; border-radius: 5px;" >
                   Identiter
                </a>
                    <a href="{{ path('app_benevoles_modifier', { 'id': benevole.id }) }}"
                        onclick="return confirm('Êtes-vous sûr de vouloir modifier ce bénévole ?');"
                       class="btn btn-success"
                       style="background-color: #ff9a3c; color: white; border: none; padding: 8px 20px; border-radius: 5px;">
                       Modifier
                    </a>
                    <a href="{{ path('app_benevoles_supprimer', {'id': benevole.id}) }}"
                       onclick="return confirm('Êtes-vous sûr de vouloir supprimer ce bénévole ?');"
                       class="btn btn-danger"
                       style="background-color: #ff0000; color: white; border: none; padding: 8px 13px; border-radius: 5px;">
                       Supprimer
                    </a>
                </td>
                <td style="white-space: nowrap;">{{ benevole.secteur }}</td>
                <td>{{ benevole.sexe }}</td>
                <td style="white-space: nowrap;">{{ benevole.nom}}</td>
                <td style="white-space: nowrap;">{{ benevole.prenom }}</td>
                <td>{{ benevole.age }}</td>
                <td style="white-space: nowrap;">{{ benevole.enfant_suivie }}</td>
                <td>
                    {{ benevole.adresse }}<br>
                    {{ benevole.code_postal }}<br>
                    {{ benevole.ville }}<br>
                    {{ benevole.telephone }}<br>
                  
                </td>

                {#<td style="white-space: nowrap;">{{ benevole.ville }}</td>#}
                <td> <a href="https://mail.google.com/mail/?view=cm&fs=1&to={{ benevole.email }}" target="_blank">
                    {{ benevole.email }}
                </a></td>
               

                <td>
                    {% if benevole.casier_judiciaire %}
                        <a href="{{ asset('uploads/casier_judiciaire/' ~ benevole.casier_judiciaire) }}" target="_blank">Voir PDF</a>
                    {% else %}
                        Pas de fichier
                    {% endif %}
                </td>
                <td>{{ benevole.plages_distances | join("<br>") |raw }}</td>
                <td>{{ benevole.matieres_accompagment | join("<br>") |raw }}</td>
                <td>{{ benevole.niveau_accompagment | join("<br>") |raw}}</td>
                {#<td>{{ benevole.information_complementaire }}</td>#}
                <td>
                  {% if benevole.connaitretescap is iterable %}
                  {{ benevole.connaitretescap | join(', ') }}
                {% else %}
                  {{ benevole.connaitretescap }}
                {% endif %}
                <td>{% if benevole.don_libre is not empty %}
                {{ benevole.don_libre }}€ don
                {% endif %}
                </td>

</td>

            </tr>
        {% endfor %}
        </tbody>
    </table>
      <button onclick="scrollToTop()" id="backToTop" title="Remonter en haut">⬆️</button>

    <script>
        // Afficher / cacher le bouton selon le scroll
        window.onscroll = function() {
            let btn = document.getElementById("backToTop");
            if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
                btn.style.display = "block";
            } else {
                btn.style.display = "none";
            }
        };

        // Fonction pour remonter en haut
        function scrollToTop() {
            window.scrollTo({top: 0, behavior: 'smooth'});
        }
    </script>
{% endblock %}
